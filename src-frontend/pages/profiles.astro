---
import AppLayout from "../layouts/AppLayout.astro";
import ModCard from "../components/ModCard.astro";
import { fetchMods } from "../data/mods";
import type { UserData } from "../types/user";
import type { ProfileData } from "../types/profile";

const mods = await fetchMods();

// TODO: Fetch actual userData from Tauri backend
const userData: UserData | null = null;

const modsCount = userData?.mods?.length ?? 0;
const modloaderName = userData?.modloader?.selectedModloader === "none" 
    ? "None" 
    : userData?.modloader?.selectedModloader === "bepinex" 
    ? "BepInEx" 
    : userData?.modloader?.selectedModloader === "melonloader"
    ? "MelonLoader"
    : "None";
const gamePathSet = userData?.config?.gamePath ? "Set" : "Not Set";
const activeProfile = userData?.profiles?.find((p: ProfileData) => p.id === userData?.activeProfileId)?.name ?? "None";

const statusBoxes = [
    {
        label: "Mods Installed",
        value: modsCount.toString(),
        textColor: "#B8E986",
        textOutlineColor: "#2A5C1A"
    },
    {
        label: "Modloader",
        value: modloaderName,
        textColor: "#FFB88C",
        textOutlineColor: "#6B3A1E"
    },
    {
        label: "Game Path",
        value: gamePathSet,
        textColor: gamePathSet === "Set" ? "#A8F5A8" : "#FFA8A8",
        textOutlineColor: gamePathSet === "Set" ? "#1E5C1E" : "#6B1E1E"
    },
    {
        label: "Active Profile",
        value: activeProfile,
        textColor: "#D4A8FF",
        textOutlineColor: "#4A1E6B"
    }
];
---

<AppLayout title="sugardust" statusBoxes={statusBoxes}>
  <div class="w-full h-full">
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 gap-y-10 pb-8 pr-2 px-6">
           {mods.map((mod) => (
               <ModCard mod={mod} />
           ))}
      </div>
  </div>
</AppLayout>

