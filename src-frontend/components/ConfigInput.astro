---
interface Props {
    id: string;
    label: string;
    description?: string;
    defaultValue?: string;
    value?: string;
    type?: 'text' | 'number' | 'path';
}

const { id, label, description, defaultValue, value = '', type = 'text' } = Astro.props;
---

<!-- Config option for text fields -->
<div class="config-input-container" data-entry-id={id}>
    <div class="input-header">
        <label class="input-label" for={id}>{label}</label>
        {defaultValue && <span class="input-default">Default: {defaultValue}</span>}
    </div>
    {description && <p class="input-description">{description}</p>}
    <div class="input-wrapper">
        <input 
            type={type === 'number' ? 'number' : 'text'}
            id={id}
            class="config-input"
            value={value}
            data-default={defaultValue}
            data-input-type={type}
            placeholder={defaultValue || 'Enter value...'}
        />
        {type === 'path' && (
            <!-- Folder SVG -->
            <button class="browse-button" data-input-id={id} title="Browse...">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                </svg>
            </button>
        )}
        <!-- Reset SVG -->
        <button class="reset-button" data-input-id={id} title="Reset to default">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                <path d="M3 3v5h5"></path>
            </svg>
        </button>
    </div>
</div>

<style>
    .config-input-container {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 16px 20px;
        background: linear-gradient(to top, #2a7a8a, #3a9aaa);
        border: 3px solid #5fc8d8;
        border-radius: 12px;
        box-shadow: inset 0 0 0 2px #2a6a7a, 0 4px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }

    .config-input-container:hover {
        border-color: #7fe8f8;
        box-shadow: inset 0 0 0 2px #2a6a7a, 0 4px 16px rgba(95, 200, 216, 0.3);
    }

    .input-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 8px;
    }

    .input-label {
        font-size: 15px;
        font-weight: 700;
        color: #e5ffff;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .input-default {
        font-size: 11px;
        color: #85c5d5;
        font-style: italic;
    }

    .input-description {
        font-size: 12px;
        color: #b5e5ef;
        margin: 0;
        line-height: 1.4;
        opacity: 0.9;
    }

    .input-wrapper {
        display: flex;
        gap: 8px;
        align-items: stretch;
    }

    .config-input {
        flex: 1;
        min-width: 0;
        padding: 12px 16px;
        background: linear-gradient(to top, #1a4a5a, #2a5a6a);
        border: 2px solid #3a6a7a;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        color: #e5ffff;
        transition: all 0.3s ease;
        outline: none;
        font-family: 'Exo', monospace;
    }

    .config-input::placeholder {
        color: rgba(229, 255, 255, 0.4);
    }

    .config-input:focus {
        border-color: #7fe8f8;
        background: linear-gradient(to top, #2a5a6a, #3a6a7a);
        box-shadow: 0 0 12px rgba(127, 232, 248, 0.3);
    }

    .config-input:hover:not(:focus) {
        border-color: #5ac0d0;
    }

    .browse-button,
    .reset-button {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px 14px;
        background: linear-gradient(to top, #3a8a9a, #4aaaaa);
        border: 2px solid #5abaca;
        border-radius: 8px;
        color: #e5ffff;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .browse-button:hover,
    .reset-button:hover {
        background: linear-gradient(to top, #4a9aaa, #5ababa);
        border-color: #7fd8e8;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .browse-button:active,
    .reset-button:active {
        transform: translateY(0);
        box-shadow: none;
    }

    .reset-button {
        background: linear-gradient(to top, #d86ab8, #e88fd0);
        border-color: #f5b8e0;
    }

    .reset-button:hover {
        background: linear-gradient(to top, #e88fd0, #f5b8e0);
        border-color: #ffcce8;
    }
</style>

<script>
    function initConfigInputs() {
        const inputs = document.querySelectorAll('.config-input-container .config-input');
        const resetButtons = document.querySelectorAll('.config-input-container .reset-button');
        
        inputs.forEach(input => {
            input.addEventListener('change', (e) => {
                const inputEl = e.target as HTMLInputElement;
                const container = inputEl.closest('.config-input-container');
                const entryId = container?.getAttribute('data-entry-id');
                const inputType = inputEl.getAttribute('data-input-type');
                
                const event = new CustomEvent('config-change', {
                    bubbles: true,
                    detail: { 
                        entryId, 
                        value: inputEl.value, 
                        type: inputType === 'number' ? 'Number' : 'String' 
                    }
                });
                document.dispatchEvent(event);
            });
        });
        
        resetButtons.forEach(button => {
            button.addEventListener('click', () => {
                const inputId = button.getAttribute('data-input-id');
                if (!inputId) return;
                
                const input = document.getElementById(inputId) as HTMLInputElement;
                if (!input) return;
                
                const defaultValue = input.getAttribute('data-default') || '';
                input.value = defaultValue;
                
                const container = input.closest('.config-input-container');
                const entryId = container?.getAttribute('data-entry-id');
                
                const event = new CustomEvent('config-change', {
                    bubbles: true,
                    detail: { entryId, value: defaultValue, type: 'String' }
                });
                document.dispatchEvent(event);
            });
        });
    }

    document.addEventListener('DOMContentLoaded', initConfigInputs);
    document.addEventListener('astro:page-load', initConfigInputs);
</script>
